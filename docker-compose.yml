version: '3.8'

services:
  app:
    container_name: ldc-shop
    build: .
    restart: always
    ports:
      - "3000:3000"
    environment:
      # Database
      - POSTGRES_URL=postgresql://postgres:postgres@db:5432/ldc_shop
      
      # App URL (Change to your domain in production)
      - NEXT_PUBLIC_APP_URL=http://localhost:3000
      
      # Auth (Required for OAuth behind reverse proxy)
      - AUTH_URL=http://localhost:3000
      - AUTH_TRUST_HOST=true
      
      # Secrets (Replace with your actual values)
      - OAUTH_CLIENT_ID=replace_with_client_id
      - OAUTH_CLIENT_SECRET=replace_with_client_secret
      - MERCHANT_ID=replace_with_merchant_id
      - MERCHANT_KEY=replace_with_merchant_key
      - ADMIN_USERS=admin,chatgpt
      
    depends_on:
      - db

  db:
    image: postgres:15-alpine
    container_name: ldc-shop-db
    restart: always
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=postgres
      - POSTGRES_DB=ldc_shop
    volumes:
      - ./postgres-data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
